# 08.2 - Customizing Beans with BeanPostProcessor
## ç°¡ä»‹
`BeanPostPorcessor` ä»‹é¢å®šç¾©å…©å€‹ callback methods ä¾›å¯¦ä½œï¼Œå®¢è£½åŒ–è‡ªå·±æˆ–æ˜¯è¦†è“‹å®¹å™¨é è¨­çš„å¯¦ä¾‹åŒ–é‚è¼¯ã€ä¾è³´é—œä¿‚è§£æé‚è¼¯ç­‰ã€‚

## ç”¨é€”
* åœ¨ Spring Container å¯¦ä¾‹åŒ– Bean ä¹‹å¾Œçš„åˆå§‹åŒ–éšæ®µï¼Œå¯¦ä½œä¸€äº›å®¢è£½åŒ–é‚è¼¯

## ç”Ÿå‘½é€±æœŸ
`BeanPostPorcessor` æœƒå° Spring IoC Conatiner å¯¦ä¾‹åŒ–å‡ºçš„ Bean è²¨å°è±¡é€²è¡Œæ“ä½œã€‚
1. Spring IoC Container å…ˆå»ºç«‹å¯¦ä¾‹
2. `BeanPostPorcessor` ä½œç”¨æ–¼ Spring IoC Container å»ºç«‹å¯¦ä¾‹å¾Œé€²å…¥åˆå§‹åŒ–éšæ®µ **_ä¹‹å‰_**

## æ³¨æ„äº‹é …
> ğŸ”” `BeanPostPorcessor` å¯¦ä¾‹çš„ä½œç”¨ç¯„åœ ( scope ) æ˜¯ä»¥ container å€åˆ†ï¼Œä¸åŒ container ä¹‹é–“çš„ `BeanPostPorcessor` ç„¡æ³•äº’ç›¸ä½œç”¨ã€‚

* ä¸€å€‹å®¹å™¨ä¸­çš„ `BeanPostPorcessor` åªæœƒå°è©²å®¹å™¨ä¸­çš„ Bean é€²è¡Œå¾Œç½®è™•ç†
* å„˜ç®¡åœ¨ç¨‹å¼é¢ä¸Šä»–å€‘æ˜¯åŒä¸€å€‹å±¤æ¬¡çµæ§‹çš„æ±è¥¿ï¼Œä½†æ˜¯ä¸åŒå®¹å™¨å°±æ˜¯ä¸åŒçš„ä¸–ç•Œ
<br/>

> ğŸ”” åœ¨æ•´å€‹ Application ä¸­å¯ä»¥è¨­å®šå¤šå€‹ `BeanPostPorcessor` å¯¦ä¾‹
* ä½¿ç”¨å®¹å™¨æä¾›é è¨­çš„ `BeanPostPorcessor` æ™‚å¯ä»¥é€é `order` å±¬æ€§ä¾†æ§åˆ¶é€™äº› `BeanPostPorcessor` å¯¦ä¾‹çš„é †åº
* å¦‚æœæ˜¯è‡ªå·±å®¢è£½åŒ–çš„ `BeanPostPorcessor`ï¼ŒåŒæ™‚å¯¦ä½œ `Ordered` ä»‹é¢ä¹‹å¾Œä¹Ÿå¯ä»¥ç”¨ `order` ä¾†æŒ‡å®šé †åº

## BeanPostProcessor
`org.springframework.beans.factory.config.BeanPostProcessor` ä»‹é¢åŒ…å«å…©å€‹ callback methodsã€‚

```java
package org.springframework.beans.factory.config;

public interface BeanPostProcessor {
    @Nullable
    default Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {
        return bean;
    }

    @Nullable
    default Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {
        return bean;
    }
}
```

åœ¨ Spring framework ä¸­æœ¬èº«å°±æœ‰è¨±å¤šé è¨­çš„ `BeanPostPorcessor`ã€‚
![](/images/spring-aop/8.2-1.png)

ç•¶æŸå€‹é¡åˆ¥è¢«è¨»å†Šç‚º post-processorï¼Œæ¯ç•¶ä¸€å€‹ Bean å¯¦ä¾‹è¢«å‰µå»ºæ™‚ï¼Œpost-processor çš„ callback methods åˆ†åˆ¥æœƒåœ¨å…©å€‹æ™‚é–“é»è¢«å‘¼å«ï¼š
1. Container åŸ·è¡Œåˆå§‹åŒ– methods ä¹‹å‰ ( åƒæ˜¯ `InitializingBean.afterPropertiesSet()` æˆ–ä»»ä½•è¢«å®£å‘Šçš„æ–¹æ³• )
2. Bean åˆå§‹åŒ–å®Œæˆå¾Œè¢«å‘¼å«ã€‚

åœ–
<br/>

ApplicationContext æœƒè‡ªå‹•åµæ¸¬é‚£äº›æœ‰å»å¯¦ä½œ `BeanPostProcessor` ä»‹é¢çš„ Beanï¼Œä¸¦å°‡ä»–å€‘è¨»å†Šç‚ºå¾Œç½®è™•ç†å™¨ã€‚ 

## å¯¦ä½œ
* å¯¦ä½œç¯„ä¾‹åƒè€ƒï¼šhttps://openhome.cc/Gossip/SpringGossip/BeanPostProcessor.html
<br/>

* ä½¿ç”¨ H2 database
  åƒè€ƒï¼šhttps://www.baeldung.com/spring-boot-h2-database

##### Dependency
```xml
<dependency>
    <groupId>com.h2database</groupId>
    <artifactId>h2</artifactId>
    <scope>runtime</scope>
</dependency>
```

##### application.yml
```yml
server:
  port: 8080

spring:
  h2:
    console:
      enabled: true
  datasource:
    url: jdbc:h2:mem:testdb # h2 database é€£æ¥ä½å€
    driver-class-name: org.h2.Driver # é…ç½®driver
    username: sa # database ç”¨æˆ¶å
    password:  # database å¯†ç¢¼

  jpa:
    database-platform: org.hibernate.dialect.H2Dialect
```
é è¨­ `username` ç‚º `sa`ï¼Œ`password` å‰‡æ˜¯ç©ºç™½ã€‚

## åƒè€ƒ
å®˜ç¶²ï¼š
* https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans

ä»¥ä¸‹æ˜¯ Baeldungï¼š
* https://www.baeldung.com/spring-annotation-bean-pre-processor
* https://www.baeldung.com/spring-beanpostprocessor

ä½†æˆ‘è¦ºå¾—é€™å…©ç¯‡è¬›å¾—æ¯”è¼ƒæ¸…æ¥š?
* https://blog.csdn.net/geekjoker/article/details/79868945
* https://stackoverflow.com/questions/29743320/how-exactly-does-the-spring-beanpostprocessor-work

å¦ä¸€ç¯‡æ›´è©³ç´°çš„ï¼Œè€Œä¸”é¼ æ¨™é»æ“Šçš„å‹•ç•«å¾ˆå¯æ„›~
* https://mrbird.cc/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Spring-BeanPostProcessor-InstantiationAwareBeanPostProcessor.html