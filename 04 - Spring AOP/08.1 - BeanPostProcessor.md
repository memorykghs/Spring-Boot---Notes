# 08.1 - BeanPostProcessor
ğŸ¤ª åˆæ˜¯ä¸€å€‹å¹³å¸¸ä¸å¤ªå¸¸ç”¨ä½†å…¶å¯¦å¾ˆå¯¦ç”¨çš„æ±æ± ğŸ¤˜ğŸ¤˜ğŸ¤˜

åœ¨é–‹ç™¼ Spring æ™‚ï¼Œå¦‚æœé‡åˆ°åŒä¸€å€‹æ–¹æ³•ä½†æ˜¯æœ‰å¤šå€‹å¯¦ä¾‹æ™‚åšçš„æƒ…æ³ï¼Œæˆ‘å€‘é€šå¸¸æœƒåœ¨å‘¼å«çš„ä½ç½®é€šé Application Context ä¾†åˆ¤æ–·è¦ä½¿ç”¨å“ªä¸€å€‹å¯¦ä¾‹ï¼Œå¦‚ï¼š
```java
if (bean instanceof FirstDao) {
    ...
} else if (bean instanceof SecondDao) {
    ...
} else if (bean instanceof ThirdDao) {
    ...
}
```

é›–ç„¶å¯ä»¥ä½¿å†å¯«ä¸€å€‹æŠ½è±¡å·¥å» æ–¹æ³•åšä½¿ç”¨ï¼Œä½†æ„Ÿè¦ºæœ‰é»å†—ã€‚ç”¨ `Autowired` æ³¨å…¥ï¼Œå‰‡éœ€è¦åœ¨æ™‚åšé¡åˆ¥ä¸Šæ¨™ä¸Š `@Primary` æˆ–æ˜¯ `@Qualify`ï¼Œä¸ç„¶åœ¨é è¨­æƒ…æ³ä¸‹ Spring æ¡†æ¶ä¸‹ä¹Ÿä¸å…è¨±å‡ºç¾å¤šå€‹æ™‚åšåŒä¸€ä»‹é¢çš„å¯¦ä¾‹ã€‚

æ‰€ä»¥å¦‚æœæƒ³è¦è§£æ±ºä¸Šé¢çš„å•é¡Œï¼Œå°±å¯ä»¥åˆ©ç”¨ Spring æ¡†æ¶æä¾›çš„åŠŸèƒ½ `BeanPostProcessor` ä¾†è™•ç†ã€‚
## ç”¨é€”?
* åœ¨ Bean åˆå§‹åŒ– ( å‰ ) å¾Œæ’å…¥è‡ªå·±çš„é‚è¼¯

p.s. å¦‚ä¸Šæ‰€è¿°ï¼Œæœ‰ post-processorï¼Œé‚£éº¼ä¹Ÿæœƒæœ‰ pre-processor

## å¥½è™•?
* å¯ä»¥å…±ç”¨åŒ / é‡è¤‡ä½¿ç”¨åŒä¸€å€‹ beanï¼Œä¸éœ€è¦å»ºç«‹å¤šå€‹åŒé¡å‹çš„ bean

ğŸ’¡ é‡åˆ°å¤šåŸ·è¡Œç·’æˆ–æ˜¯å¤§é‡è³‡æ–™çš„æ™‚å€™æ€éº¼è¾¦?
ğŸ’¡ çœŸçš„éƒ½æ˜¯åŒä¸€å€‹å¯¦ä¾‹?
ğŸ’¡ éœ€è¦åŠ  dependency???

## å¦‚ä½•é‹ä½œ?ç”Ÿå‘½é€±æœŸ?

åœ¨ Spring ä¸­ Bean çš„ç”Ÿå‘½é€±æœŸå¯ä»¥å¤§è‡´ä¸Šåˆ†æˆå…©å¡Šï¼šInstantiation èˆ‡ Initializatoinã€‚Instantiation ( å¯¦ä¾‹åŒ– ) æŒ‡çš„æ˜¯ Bean å‰µå»ºçš„éç¨‹ï¼›è€Œ Initializatoin ( åˆå§‹åŒ– ) å‰‡æ˜¯ Bean å»ºç«‹å¾Œï¼Œå°å…¶å¿…è¦çš„ä¾è³´æˆ–æ˜¯å±¬æ€§é€²è¡Œæ³¨å…¥æˆ–è³¦å€¼ã€å¾Œç½®è™•ç†ç­‰æ“ä½œã€‚

![](/images/spring-aop/8.1-1.jpg)

åœ¨ Load Bean Definitions éšæ®µï¼š
* å¸¶æœ‰ `@Configuration`ã€`@Components` ä»¥åŠ XML æª”æ¡ˆä¸­é…ç½®çš„ bean æœƒè¢«æƒç„ã€è§£æä¸¦è™•ç†

* å°‡ bean definition åŠ å…¥ BeanFactory

* ç‰¹å®šçš„ `BeanFactoryPostProcessor` bean è¢«èª¿ç”¨ï¼Œå¯ä»¥ä¿®æ”¹ä»»ä½• bean definition ( é¡ä¼¼æ–¼ä½”ä½ç¬¦çš„åŠŸèƒ½ï¼Œåœ¨è¼‰å…¥ bean definition å¾Œæ›¿æ›æ‰ )

Bean Creation éšæ®µï¼š
* é»˜èªæƒ…æ³ä¸‹ï¼Œæ¯å€‹ Bean æœƒè¢«ç©æ¥µçš„å¯¦ä¾‹åŒ– ( ä»¥æ­£ç¢ºçš„é †åºå»ºç«‹ä¸¦æ³¨å…¥ä¾è³´ )

* åœ¨ä¾è³´æ³¨å…¥ä¹‹å¾Œï¼Œæ¯å€‹ Bean éƒ½æœƒç¶“éä¸€å€‹ post-processing éšæ®µ ( å¾Œè™•ç†éšæ®µ )ï¼Œåœ¨é€™å€‹éšæ®µå¯èƒ½æœƒç™¼ç”Ÿé€²ä¸€æ­¥çš„é…ç½®å’Œåˆå§‹åŒ–

* åœ¨ post-processing ä¹‹å¾Œï¼ŒBean æœƒè¢«å®Œå…¨åˆå§‹åŒ–ä¸¦ç­‰å¾…è¢«ä½¿ç”¨ ( trace by ID )

## Dependency

```xml
<dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-context-support</artifactId>
    <version>5.2.2.RELEASE</version>
</dependency>
```

> **generic**
generic meansï¼šshared by, typical of, or relating to a whole group of similar things, rather than to any particular thing

## åƒè€ƒ
å®˜ç¶²ï¼š
* https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans

ä»¥ä¸‹æ˜¯ Baeldungï¼š
* https://www.baeldung.com/spring-annotation-bean-pre-processor
* https://www.baeldung.com/spring-beanpostprocessor

ä½†æˆ‘è¦ºå¾—é€™å…©ç¯‡è¬›å¾—æ¯”è¼ƒæ¸…æ¥š?
* https://blog.csdn.net/geekjoker/article/details/79868945
* https://stackoverflow.com/questions/29743320/how-exactly-does-the-spring-beanpostprocessor-work

å¦ä¸€ç¯‡æ›´è©³ç´°çš„ï¼Œè€Œä¸”é¼ æ¨™é»æ“Šçš„å‹•ç•«å¾ˆå¯æ„›~
* https://mrbird.cc/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3Spring-BeanPostProcessor-InstantiationAwareBeanPostProcessor.html